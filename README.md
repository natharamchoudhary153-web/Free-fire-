using UnityEngine;

[RequireComponent(typeof(Rigidbody))]
public class PlayerController : MonoBehaviour
{
    public float moveSpeed = 6f;
        public float lookSpeed = 2f;
            public Transform cameraTransform;
                public Weapon startingWeapon;
                    public Parachute parachute;

                        Rigidbody rb;
                            Weapon currentWeapon;
                                float yaw = 0f;
                                    float pitch = 0f;
                                        bool isGrounded = true;

                                            void Start()
                                                {
                                                        rb = GetComponent<Rigidbody>();
                                                                Cursor.lockState = CursorLockMode.Locked;

                                                                        if (startingWeapon != null)
                                                                                    EquipWeapon(startingWeapon);
                                                                                        }

                                                                                            void Update()
                                                                                                {
                                                                                                        Look();
                                                                                                                HandleInput();
                                                                                                                    }

                                                                                                                        void FixedUpdate()
                                                                                                                            {
                                                                                                                                    Move();
                                                                                                                                        }

                                                                                                                                            void Look()
                                                                                                                                                {
                                                                                                                                                        float mx = Input.GetAxis("Mouse X") * lookSpeed;
                                                                                                                                                                float my = Input.GetAxis("Mouse Y") * lookSpeed;

                                                                                                                                                                        yaw += mx;
                                                                                                                                                                                pitch -= my;
                                                                                                                                                                                        pitch = Mathf.Clamp(pitch, -60f, 60f);

                                                                                                                                                                                                transform.rotation = Quaternion.Euler(0f, yaw, 0f);
                                                                                                                                                                                                        if (cameraTransform) cameraTransform.localEulerAngles = new Vector3(pitch, 0f, 0f);
                                                                                                                                                                                                            }

                                                                                                                                                                                                                void Move()
                                                                                                                                                                                                                    {
                                                                                                                                                                                                                            Vector3 forward = transform.forward * Input.GetAxis("Vertical");
                                                                                                                                                                                                                                    Vector3 right = transform.right * Input.GetAxis("Horizontal");
                                                                                                                                                                                                                                            Vector3 vel = (forward + right).normalized * moveSpeed;
                                                                                                                                                                                                                                                    Vector3 newVel = new Vector3(vel.x, rb.velocity.y, vel.z);
                                                                                                                                                                                                                                                            rb.velocity = newVel;
                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                    void HandleInput()
                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                if (Input.GetButtonDown("Fire1") && currentWeapon != null)
                                                                                                                                                                                                                                                                                            currentWeapon.TryShoot(cameraTransform.position, cameraTransform.forward);

                                                                                                                                                                                                                                                                                                    if (Input.GetKeyDown(KeyCode.Space) && parachute != null)
                                                                                                                                                                                                                                                                                                                parachute.Deploy();

                                                                                                                                                                                                                                                                                                                        // simple pickup: press E to pick nearby loot
                                                                                                                                                                                                                                                                                                                                if (Input.GetKeyDown(KeyCode.E))
                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                    Collider[] hits = Physics.OverlapSphere(transform.position, 2f);
                                                                                                                                                                                                                                                                                                                                                                foreach (var c in hits)
                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                            LootItem li = c.GetComponent<LootItem>();
                                                                                                                                                                                                                                                                                                                                                                                                            if (li != null)
                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                li.Pickup(this);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                public void EquipWeapon(Weapon w)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (currentWeapon != null) Destroy(currentWeapon.gameObject);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    currentWeapon = Instantiate(w, transform);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            currentWeapon.owner = this;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

public class Weapon : MonoBehaviour
{
    public GameObject bulletPrefab;
        public Transform muzzle;
            public float fireRate = 5f; // rounds per second
                public int magazine = 30;
                    public float bulletSpeed = 40f;
                        public float recoil = 0.5f;
                            [HideInInspector] public PlayerController owner;

                                float lastFire = 0f;
                                    int currentAmmo;

                                        void Start()
                                            {
                                                    currentAmmo = magazine;
                                                        }

                                                            public void TryShoot(Vector3 origin, Vector3 direction)
                                                                {
                                                                        if (Time.time - lastFire < 1f / fireRate) return;
                                                                                if (currentAmmo <= 0) return;

                                                                                        lastFire = Time.time;
                                                                                                currentAmmo--;

                                                                                                        Vector3 dir = direction;
                                                                                                                dir += Random.insideUnitSphere * recoil * 0.01f;
                                                                                                                        GameObject b = Instantiate(bulletPrefab, muzzle.position, Quaternion.LookRotation(dir));
                                                                                                                                Rigidbody rb = b.GetComponent<Rigidbody>();
                                                                                                                                        if (rb != null) rb.velocity = dir.normalized * bulletSpeed;
                                                                                                                                            }
                                                                                                                                            }
                                                                                                                          public class Bullet : MonoBehaviour
                                                                                                                          {
                                                                                                                              public float damage = 25f;
                                                                                                                                  public float lifetime = 5f;
                                                                                                                                      public GameObject hitEffect;

                                                                                                                                          void Start() => Destroy(gameObject, lifetime);

                                                                                                                                              void OnCollisionEnter(Collision col)
                                                                                                                                                  {
                                                                                                                                                          var h = col.collider.GetComponent<Health>();
                                                                                                                                                                  if (h != null)
                                                                                                                                                                          {
                                                                                                                                                                                      h.TakeDamage(damage);
                                                                                                                                                                                              }

                                                                                                                                                                                                      if (hitEffect != null) Instantiate(hitEffect, transform.position, Quaternion.identity);
                                                                                                                                                                                                              Destroy(gameObject);
                                                                                                                                                                                                                  }
                                                                                                                                                                                                                  }
                                                                                                                                                                                                                  using UnityEngine;
                                                                                                                                                                                                                  using System.Collections;

                                                                                                                                                                                                                  public class Health : MonoBehaviour
                                                                                                                                                                                                                  {
                                                                                                                                                                                                                      public float maxHealth = 100f;
                                                                                                                                                                                                                          public float currentHealth;
                                                                                                                                                                                                                              public bool destroyOnDeath = false;
                                                                                                                                                                                                                                  public GameObject ragdollPrefab;

                                                                                                                                                                                                                                      void Start() { currentHealth = maxHealth; }

                                                                                                                                                                                                                                          public void TakeDamage(float dmg)
                                                                                                                                                                                                                                              {
                                                                                                                                                                                                                                                      currentHealth -= dmg;
                                                                                                                                                                                                                                                              if (currentHealth <= 0) Die();
                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                      void Die()
                                                                                                                                                                                                                                                                          {
                                                                                                                                                                                                                                                                                  // placeholder: destroy or respawn via GameManager
                                                                                                                                                                                                                                                                                          var gm = FindObjectOfType<GameManager>();
                                                                                                                                                                                                                                                                                                  if (gm != null) gm.OnPlayerDied(gameObject);

                                                                                                                                                                                                                                                                                                          if (destroyOnDeath) Destroy(gameObject);
                                                                                                                                                                                                                                                                                                                  else gameObject.SetActive(false);
                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                  public enum LootType { Weapon, Ammo, HealthPack }

                                                                                                                                                                                                                                                                                                                                  public class LootItem : MonoBehaviour
                                                                                                                                                                                                                                                                                                                                  {
                                                                                                                                                                                                                                                                                                                                      public LootType type;
                                                                                                                                                                                                                                                                                                                                          public Weapon weaponPrefab;
                                                                                                                                                                                                                                                                                                                                              public int ammoAmount = 30;
                                                                                                                                                                                                                                                                                                                                                  public float healAmount = 50f;

                                                                                                                                                                                                                                                                                                                                                      public void Pickup(PlayerController player)
                                                                                                                                                                                                                                                                                                                                                          {
                                                                                                                                                                                                                                                                                                                                                                  switch (type)
                                                                                                                                                                                                                                                                                                                                                                          {
                                                                                                                                                                                                                                                                                                                                                                                      case LootType.Weapon:
                                                                                                                                                                                                                                                                                                                                                                                                      if (weaponPrefab != null) player.EquipWeapon(weaponPrefab);
                                                                                                                                                                                                                                                                                                                                                                                                                      break;
                                                                                                                                                                                                                                                                                                                                                                                                                                  case LootType.Ammo:
                                                                                                                                                                                                                                                                                                                                                                                                                                                  // simplistic: give new weapon ammo if player has one
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  var w = player.GetComponentInChildren<Weapon>();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (w != null) w.SendMessage("AddAmmo", ammoAmount, SendMessageOptions.DontRequireReceiver);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              case LootType.HealthPack:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              var h = player.GetComponent<Health>();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (h != null) { h.currentHealth = Mathf.Min(h.maxHealth, h.currentHealth + healAmount); }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Destroy(gameObject);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  public class LootSpawner : MonoBehaviour
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      public Transform[] spawnPoints;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          public GameObject[] lootPrefabs;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              public float spawnInterval = 30f;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  void Start()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              InvokeRepeating(nameof(SpawnLoot), 1f, spawnInterval);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      void SpawnLoot()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  foreach (var p in spawnPoints)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (Random.value < 0.5f && lootPrefabs.Length > 0)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  var prefab = lootPrefabs[Random.Range(0, lootPrefabs.Length)];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Instantiate(prefab, p.position, Quaternion.identity);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         public class Parachute : MonoBehaviour
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             public float fallSpeed = -20f;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 public float parachuteFall = -3f;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     public bool deployed = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Rigidbody rb;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             void Start()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         rb = GetComponentInParent<Rigidbody>();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 public void Deploy()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             if (deployed) return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     deployed = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             // reduce downward velocity and simulate drag
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     StartCoroutine(ParachuteRoutine());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             System.Collections.IEnumerator ParachuteRoutine()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         float t = 0f;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 while (t < 5f)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     if (rb != null)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Vector3 v = rb.velocity;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 v.y = Mathf.Max(v.y, parachuteFall);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 rb.velocity = v;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         t += Time.deltaTime;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     yield return null;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        public class SafeZoneShrinker : MonoBehaviour
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            public float initialRadius = 100f;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                public float shrinkTo = 10f;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    public float shrinkDuration = 120f; // seconds
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        public Vector3 center = Vector3.zero;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            float startTime;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                void Start() { startTime = Time.time; transform.position = center; transform.localScale = Vector3.one * initialRadius * 2f; }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    void Update()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                float t = (Time.time - startTime) / shrinkDuration;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        t = Mathf.Clamp01(t);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                float radius = Mathf.Lerp(initialRadius, shrinkTo, t);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        transform.localScale = Vector3.one * radius * 2f;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // optionally apply damage to players outside the circle (not shown)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        public class GameManager : MonoBehaviour
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            public Transform[] spawnPoints;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                public GameObject playerPrefab;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    public void OnPlayerDied(GameObject player)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // very simple: respawn after 3 seconds
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        StartCoroutine(RespawnRoutine(player));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                System.Collections.IEnumerator RespawnRoutine(GameObject player)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            yield return new WaitForSeconds(3f);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (player == null && playerPrefab != null)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Transform sp = spawnPoints[Random.Range(0, spawnPoints.Length)];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Instantiate(playerPrefab, sp.position + Vector3.up * 1.5f, Quaternion.identity);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    else if (player != null)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        player.SetActive(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    var h = player.GetComponent<Health>();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (h != null) h.currentHealth = h.maxHealth;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Transform sp = spawnPoints[Random.Range(0, spawnPoints.Length)];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        player.transform.position = sp.position + Vector3.up * 1.5f;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                